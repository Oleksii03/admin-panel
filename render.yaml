previews:
  generation: automatic

services:
  - type: web
    name: admin-panel-ws
    runtime: node
    plan: free
    buildCommand: npm ci
    startCommand: node server/socket-server.js
    healthCheckPath: /
    envVars:
      - key: NODE_VERSION
        value: 20

  # Frontend (Vite/Vue) as Static Site
  - type: web
    name: admin-panel-frontend
    runtime: static
    plan: free
    # Inject WS URL into Vite build using the ws service host
    buildCommand: VITE_SOCKET_URL="https://${WS_HOST}" npm ci && npm run build-only
    staticPublishPath: ./dist
    envVars:
      - key: WS_HOST
        fromService:
          name: admin-panel-ws
          type: web
          property: host
